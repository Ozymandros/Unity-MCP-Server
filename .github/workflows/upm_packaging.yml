name: UPM Packaging

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    name: Create UPM Package
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify Package Version
        id: version_check
        run: |
          PACKAGE_VERSION=$(jq -r .version package.json)
          TAG_VERSION=${GITHUB_REF#refs/tags/v}
          if [ "$PACKAGE_VERSION" != "$TAG_VERSION" ]; then
            echo "Error: package.json version ($PACKAGE_VERSION) does not match tag ($TAG_VERSION)"
            exit 1
          fi

      - name: Create Release Archive
        run: |
          # Create a zip of the root directory contents, excluding ignored files
          zip -r unity-mcp-server-${{ github.ref_name }}.zip . -x ".git/*" ".github/*" ".gitignore" "walkthrough.md" "task.md" "implementation_plan.md"

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: unity-mcp-server-${{ github.ref_name }}.zip
          generate_release_notes: true
